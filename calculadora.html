<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Calculadora básica</title>
  <style>
    :root{
      --bg:#2205fc; /* celeste muy claro */
      --panel:hsl(0, 0%, 98%); /* blanco */
      --accent:hsl(244, 95%, 50%); /* celeste intenso */
      --btn:#f0f9ff;
      --btn-ops:hsl(240, 20%, 98%);
      --txt:#0f172a;
    }
    *{box-sizing:border-box}
    body{
      margin:0; font-family:Inter, system-ui, Arial, sans-serif;
      background:linear-gradient(180deg,#02a7fa 0%, #e6f7ff 100%);
      color:var(--txt); min-height:100vh; display:flex; align-items:center; justify-content:center; padding:24px;
    }
    .calc{
      width:360px; max-width:100%; background:var(--panel); border-radius:16px; padding:18px; box-shadow:0 12px 30px rgba(0,0,0,0.25);
    }
    .display{
      background:#f6f6f8; padding:14px; border-radius:10px; text-align:right; font-size:28px; min-height:56px; display:flex; flex-direction:column; justify-content:center; gap:6px; margin-bottom:12px; box-shadow:inset 0 2px 5px rgba(0,0,0,0.1);
    }
    .expression{ font-size:14px; color:rgba(15,23,42,0.6); overflow:hidden; text-overflow:ellipsis; white-space:nowrap }
    .result{ font-weight:700; font-size:28px }
    .keys{ display:grid; grid-template-columns:repeat(4,1fr); gap:10px }
    button{
      border:0; padding:16px; border-radius:10px; font-size:18px; cursor:pointer; background:var(--btn); color:var(--txt); box-shadow:0 4px 6px rgba(0,0,0,0.1);
      transition:all 0.2s;
    }
    button:hover{ transform:translateY(-2px); box-shadow:0 6px 12px rgba(0,0,0,0.15); }
    button:active{ transform:translateY(0); box-shadow:0 2px 4px rgba(0,0,0,0.1); }
    button.op{ background:var(--btn-ops); }
    button.equal{ background:var(--accent); color:#fff; grid-column:span 2 }
    button.span2{ grid-column:span 2 }
    .small{ padding:10px; font-size:16px }
    .history{
      margin-top:14px; max-height:120px; overflow:auto; background:#f9fdff; padding:8px; border-radius:8px; font-size:13px; box-shadow:inset 0 1px 4px rgba(0,0,0,0.08);
    }
    .history-item{ padding:6px 8px; border-radius:6px; display:flex; justify-content:space-between; gap:8px; align-items:center }
    .history-item:hover{ background:rgba(6,182,212,0.1) }
    .kbd-hint{ font-size:12px; color:rgba(15,23,42,0.6); margin-top:8px }
  </style>
</head>
<body>
  <main class="calc" role="application" aria-label="Calculadora básica">
    <div class="display" id="display">
      <div class="expression" id="expression">0</div>
      <div class="result" id="result">0</div>
    </div>

    <div class="keys" role="group" aria-label="Teclado de la calculadora">
      <button class="small" data-action="clear" aria-label="Limpiar">C</button>
      <button class="small" data-action="back" aria-label="Borrar">⌫</button>
      <button class="small op" data-value="%" aria-label="Porcentaje">%</button>
      <button class="small op" data-value="/" aria-label="División">÷</button>

      <button data-value="7">7</button>
      <button data-value="8">8</button>
      <button data-value="9">9</button>
      <button class="op" data-value="*" aria-label="Multiplicación">×</button>

      <button data-value="4">4</button>
      <button data-value="5">5</button>
      <button data-value="6">6</button>
      <button class="op" data-value="-" aria-label="Resta">−</button>

      <button data-value="1">1</button>
      <button data-value="2">2</button>
      <button data-value="3">3</button>
      <button class="op" data-value="+" aria-label="Suma">+</button>

      <button class="span2" data-value="0">0</button>
      <button data-value=".">.</button>
      <button class="equal" data-action="equals" aria-label="Igual">=</button>
    </div>

    <div class="kbd-hint">Teclas: números, + - * / . Enter(=) Backspace, Esc(limpiar)</div>

    <div class="history" id="history" aria-live="polite" aria-label="Historial"></div>
  </main>

  <script>
    // Elementos
    const exprEl = document.getElementById('expression');
    const resEl  = document.getElementById('result');
    const historyEl = document.getElementById('history');

    let expression = '';

    // Actualiza la UI
    function updateDisplay(){
      exprEl.textContent = expression || '0';
      const trimmed = expression.trim();
      if(!expression || /[+\-*/.]$/.test(trimmed) || !isSafe(expression)){
        resEl.textContent = '';
        return;
      }
      try{
        const val = evaluate(expression);
        if (val === undefined || val === null) { resEl.textContent = ''; return; }
        const displayVal = Number.isFinite(val) ? (Math.round((val + Number.EPSILON) * 1e12)/1e12) : val;
        resEl.textContent = String(displayVal);
      }catch(e){ resEl.textContent = ''; }
    }

    function isSafe(s){ return /^[-+*/%() 0-9.]+$/.test(s); }

    function evaluate(s){
      s = s.replace(/÷/g,'/').replace(/×/g,'*').replace(/−/g,'-');
      s = s.replace(/(\d+(?:\.\d+)?)%/g, '($1/100)');
      return Function('return (' + s + ')')();
    }

    document.querySelectorAll('button[data-value]').forEach(btn=>{
      btn.addEventListener('click', ()=>{ expression += btn.getAttribute('data-value'); updateDisplay(); });
    });

    document.querySelector('button[data-action="clear"]').addEventListener('click', ()=>{ expression = ''; updateDisplay(); });
    document.querySelector('button[data-action="back"]').addEventListener('click', ()=>{ expression = expression.slice(0,-1); updateDisplay(); });
    document.querySelector('button[data-action="equals"]').addEventListener('click', computeResult);

    function computeResult(){
      if(!expression) return;
      const trimmed = expression.trim();
      if(/[+\-*/.]$/.test(trimmed)) return;
      if(!isSafe(expression)){ resEl.textContent = 'Entrada inválida'; return; }
      try{
        const val = evaluate(expression);
        if (!Number.isFinite(val)) return;
        const displayVal = Math.round((val + Number.EPSILON) * 1e12)/1e12;
        const item = document.createElement('div');
        item.className = 'history-item';
        item.innerHTML = `<div>${escapeHtml(expression)}</div><div style="opacity:0.85">= ${escapeHtml(String(displayVal))}</div>`;
        historyEl.prepend(item);
        expression = String(displayVal);
        updateDisplay();
      }catch(e){}
    }

    window.addEventListener('keydown', (e)=>{
      if(e.key === 'Enter') { e.preventDefault(); computeResult(); }
      else if(e.key === 'Backspace'){ expression = expression.slice(0,-1); updateDisplay(); }
      else if(e.key === 'Escape'){ expression = ''; updateDisplay(); }
      else if(/^[0-9+\-*/().%]$/.test(e.key)){ expression += e.key; updateDisplay(); }
    });

    function escapeHtml(s){ return s.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }

    updateDisplay();
  </script>
</body>
</html>
